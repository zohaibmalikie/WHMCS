function initStripeSEPA(){var e=jQuery("#frmPayment");if(e.length){jQuery("#inputBankAcctType").closest("div.form-group").slideUp().remove(),jQuery("#inputBankRoutingNum").closest("div.form-group").slideUp().remove(),jQuery("#inputBankName").closest("div.form-group").slideUp().remove(),jQuery("#inputBankAcctNum").closest("div.form-group").slideUp().remove(),jQuery("#billingAddressChoice").closest("div.form-group").slideUp().remove(),jQuery("#inputDescriptionContainer").before('<div id="ibanElementContainer" class="form-group bank-details">\n    <label for="ibanElement" class="col-sm-4 control-label">\n'+lang.iban+'    </label>\n<div class="col-sm-7">    <div class="input-inline form-control" id="ibanElement">\n</div>    </div>\n</div><div id="mandateAcceptanceContainer" class="form-group bank-details">\n    <div class="alert alert-info" id="mandateAcceptance">\n'+lang.mandate_acceptance+"    </div>\n</div>");var i=jQuery('input[name="paymethod"]:checked').val(),t=jQuery("#ibanElementContainer"),n=jQuery("#mandateAcceptanceContainer"),a=jQuery("#inputBankAcctHolderName").closest("div.form-group");iban.mount("#ibanElement"),e.off("submit"),iban.off("change"),"new"===i?(t.not(":visible")&&(t.show("fast"),iban.on("change",stripe_sepa_iban_change_event),e.on("submit.stripe_sepa",stripe_sepa_form_submit)),n.not(":visible")&&n.show("fast"),a.not(":visible")&&a.show("fast")):(t.is(":visible")&&t.hide("fast"),n.is(":visible")&&n.hide("fast"),a.is(":visible")&&a.hide("fast")),jQuery('input[name="paymethod"]').on("ifChecked",function(){t=jQuery("#ibanElementContainer"),n=jQuery("#mandateAcceptanceContainer"),a=jQuery("#inputBankAcctHolderName").closest("div.form-group"),"new"===jQuery(this).val()?(t.not(":visible")&&(t.show("fast"),iban.on("change",stripe_sepa_iban_change_event),e.on("submit.stripe_sepa",stripe_sepa_form_submit)),n.not(":visible")&&n.show("fast"),a.not(":visible")&&a.show("fast")):(t.is(":visible")&&(t.hide("fast"),iban.off("change"),e.off("submit.stripe_sepa")),n.is(":visible")&&n.hide("fast"),a.is(":visible")&&a.hide("fast"))})}}function stripe_sepa_iban_change_event(e){var i=jQuery(".gateway-errors").first(),t=i.closest("form");e.error&&e.error.message.length?(i.html(e.error.message),i.not(":visible")&&i.slideDown(),t.find('button[type="submit"]').prop("disabled",!1).removeClass("disabled").find("span").toggle(),scrollToGatewayInputError()):i.is(":visible")&&i.slideUp()}function stripe_sepa_form_submit(e){var i=jQuery("#btnSubmit").addClass("disabled").prop("disabled",!0);e.preventDefault();var t={type:"sepa_debit",currency:"eur",owner:{name:jQuery("#inputBankAcctHolderName").val(),email:clientEmail},mandate:{notification_method:"email"}};stripe.createSource(iban,t).then(function(e){var t=jQuery(".gateway-errors").first();e.error&&e.error.message.length?(t.html(e.error.message),t.not(":visible")&&(t.slideDown(),i.removeClass("disabled").prop("disabled",!1))):(t.slideUp(),stripeSourceHandler(e.source))})}function stripeSourceHandler(e){var i=document.getElementById("frmPayment"),t=document.createElement("input");t.setAttribute("type","hidden"),t.setAttribute("name","remoteStorageToken"),t.setAttribute("value",e.id),i.appendChild(t),i.submit()}